<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gccjit (gccjit.Gccjit)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">gccjit</a> &#x00BB; Gccjit</nav><header class="odoc-preamble"><h1>Module <code><span>Gccjit</span></code></h1><p>OCaml bindings for <code>libgccjit</code>.</p><p>See <a href="https://gcc.gnu.org/wiki/JIT">GCC wiki page</a> for more information.</p></header><nav class="odoc-toc"><ul><li><a href="#contexts">Compilation Contexts</a></li><li><a href="#fields">Fields</a></li><li><a href="#structs">Structure Types</a></li><li><a href="#types">Types</a></li><li><a href="#rvalues">Rvalues</a></li><li><a href="#lvalues">Lvalues</a></li><li><a href="#params">Parameters</a></li><li><a href="#functions">Functions</a></li><li><a href="#blocks">Basic Blocks</a></li><li><a href="#locations">Source Locations</a><ul><li><a href="#faking-it">Faking it</a></li></ul></li><li><a href="#inmemory">In-memory compilation</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec exception anchored" id="exception-Error"><a href="#exception-Error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Error</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>This exception (containing an explanatory string) is raised if an error occurs.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-context"><a href="#type-context" class="anchor"></a><code><span><span class="keyword">type</span> context</span></code></div><div class="spec-doc"><p>The type of compilation contexts. See <a href="#contexts" title="contexts">Compilation Contexts</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-result"><a href="#type-result" class="anchor"></a><code><span><span class="keyword">type</span> result</span></code></div><div class="spec-doc"><p>A <a href="#type-result"><code>result</code></a> encapsulates the result of an in-memory compilation.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-location"><a href="#type-location" class="anchor"></a><code><span><span class="keyword">type</span> location</span></code></div><div class="spec-doc"><p>A <a href="#type-location"><code>location</code></a> encapsulates a source code location, so that you can (optionally) associate locations in your languages with statements in the JIT-compiled code, alowing the debugger to single-step through your language. See <a href="#locations" title="locations">Source locations</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-param"><a href="#type-param" class="anchor"></a><code><span><span class="keyword">type</span> param</span></code></div><div class="spec-doc"><p>A <a href="#type-param"><code>param</code></a> is a function parameter. See <a href="#params" title="params">Parameters</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-lvalue"><a href="#type-lvalue" class="anchor"></a><code><span><span class="keyword">type</span> lvalue</span></code></div><div class="spec-doc"><p>An <a href="#type-lvalue"><code>lvalue</code></a> is something that can be the left-hand side of an assignment. See <a href="#lvalues" title="lvalues">Lvalues</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-rvalue"><a href="#type-rvalue" class="anchor"></a><code><span><span class="keyword">type</span> rvalue</span></code></div><div class="spec-doc"><p>A <code>rvalue</code> is an expression within your code, with some type. See <a href="#rvalues" title="rvalues">RValues</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-field"><a href="#type-field" class="anchor"></a><code><span><span class="keyword">type</span> field</span></code></div><div class="spec-doc"><p>The type of fields of structs and unions. See <a href="#fields" title="fields">Fields</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-struct_"><a href="#type-struct_" class="anchor"></a><code><span><span class="keyword">type</span> struct_</span></code></div><div class="spec-doc"><p>The type of structure types. See <a href="#structs" title="structs">Structure Types</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-type_"><a href="#type-type_" class="anchor"></a><code><span><span class="keyword">type</span> type_</span></code></div><div class="spec-doc"><p>The type of C types, e.g. <code>int</code> or a <code>struct foo*</code>. See <a href="#types" title="types">Types</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-function_"><a href="#type-function_" class="anchor"></a><code><span><span class="keyword">type</span> function_</span></code></div><div class="spec-doc"><p>The type of functios. See <a href="#functions" title="functions">Functions</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-block"><a href="#type-block" class="anchor"></a><code><span><span class="keyword">type</span> block</span></code></div><div class="spec-doc"><p>The type of basic blocks. See <a href="#blocks" title="blocks">Basic Blocks</a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-unary_op"><a href="#type-unary_op" class="anchor"></a><code><span><span class="keyword">type</span> unary_op</span><span> = </span></code><ol><li id="type-unary_op.Negate" class="def variant constructor anchored"><a href="#type-unary_op.Negate" class="anchor"></a><code><span>| </span><span><span class="constructor">Negate</span></span></code></li><li id="type-unary_op.Bitwise_negate" class="def variant constructor anchored"><a href="#type-unary_op.Bitwise_negate" class="anchor"></a><code><span>| </span><span><span class="constructor">Bitwise_negate</span></span></code></li><li id="type-unary_op.Logical_negate" class="def variant constructor anchored"><a href="#type-unary_op.Logical_negate" class="anchor"></a><code><span>| </span><span><span class="constructor">Logical_negate</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-binary_op"><a href="#type-binary_op" class="anchor"></a><code><span><span class="keyword">type</span> binary_op</span><span> = </span></code><ol><li id="type-binary_op.Plus" class="def variant constructor anchored"><a href="#type-binary_op.Plus" class="anchor"></a><code><span>| </span><span><span class="constructor">Plus</span></span></code></li><li id="type-binary_op.Minus" class="def variant constructor anchored"><a href="#type-binary_op.Minus" class="anchor"></a><code><span>| </span><span><span class="constructor">Minus</span></span></code></li><li id="type-binary_op.Mult" class="def variant constructor anchored"><a href="#type-binary_op.Mult" class="anchor"></a><code><span>| </span><span><span class="constructor">Mult</span></span></code></li><li id="type-binary_op.Divide" class="def variant constructor anchored"><a href="#type-binary_op.Divide" class="anchor"></a><code><span>| </span><span><span class="constructor">Divide</span></span></code></li><li id="type-binary_op.Modulo" class="def variant constructor anchored"><a href="#type-binary_op.Modulo" class="anchor"></a><code><span>| </span><span><span class="constructor">Modulo</span></span></code></li><li id="type-binary_op.Bitwise_and" class="def variant constructor anchored"><a href="#type-binary_op.Bitwise_and" class="anchor"></a><code><span>| </span><span><span class="constructor">Bitwise_and</span></span></code></li><li id="type-binary_op.Bitwise_xor" class="def variant constructor anchored"><a href="#type-binary_op.Bitwise_xor" class="anchor"></a><code><span>| </span><span><span class="constructor">Bitwise_xor</span></span></code></li><li id="type-binary_op.Bitwise_or" class="def variant constructor anchored"><a href="#type-binary_op.Bitwise_or" class="anchor"></a><code><span>| </span><span><span class="constructor">Bitwise_or</span></span></code></li><li id="type-binary_op.Logical_and" class="def variant constructor anchored"><a href="#type-binary_op.Logical_and" class="anchor"></a><code><span>| </span><span><span class="constructor">Logical_and</span></span></code></li><li id="type-binary_op.Logical_or" class="def variant constructor anchored"><a href="#type-binary_op.Logical_or" class="anchor"></a><code><span>| </span><span><span class="constructor">Logical_or</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-comparison"><a href="#type-comparison" class="anchor"></a><code><span><span class="keyword">type</span> comparison</span><span> = </span></code><ol><li id="type-comparison.Eq" class="def variant constructor anchored"><a href="#type-comparison.Eq" class="anchor"></a><code><span>| </span><span><span class="constructor">Eq</span></span></code></li><li id="type-comparison.Ne" class="def variant constructor anchored"><a href="#type-comparison.Ne" class="anchor"></a><code><span>| </span><span><span class="constructor">Ne</span></span></code></li><li id="type-comparison.Lt" class="def variant constructor anchored"><a href="#type-comparison.Lt" class="anchor"></a><code><span>| </span><span><span class="constructor">Lt</span></span></code></li><li id="type-comparison.Le" class="def variant constructor anchored"><a href="#type-comparison.Le" class="anchor"></a><code><span>| </span><span><span class="constructor">Le</span></span></code></li><li id="type-comparison.Gt" class="def variant constructor anchored"><a href="#type-comparison.Gt" class="anchor"></a><code><span>| </span><span><span class="constructor">Gt</span></span></code></li><li id="type-comparison.Ge" class="def variant constructor anchored"><a href="#type-comparison.Ge" class="anchor"></a><code><span>| </span><span><span class="constructor">Ge</span></span></code></li></ol></div></div><h2 id="contexts"><a href="#contexts" class="anchor"></a>Compilation Contexts</h2><p>A <a href="#type-context"><code>context</code></a> encapsulates the state of a compilation. You can <a href="Context/index.html#val-set_option" title="Context.set_option">set up options</a> on it, add <a href="#types" title="types">types</a>, <a href="#functions" title="functions">functions</a> and <a href="#blocks" title="blocks">code</a>, using the API below.</p><p>Invoking <a href="Context/index.html#val-compile"><code>Context.compile</code></a> on it gives you a <a href="#type-result"><code>result</code></a>, representing in-memory machine-code.</p><p>You can call <a href="Context/index.html#val-compile"><code>Context.compile</code></a> repeatedly on one context, giving multiple independent results.</p><p>Similarly, you can call <a href="Context/index.html#val-compile_to_file"><code>Context.compile_to_file</code></a> on a context to compile to disk.</p><p>Eventually you can call <a href="Context/index.html#val-release"><code>Context.release</code></a> to clean up the context; any in-memory results created from it are still usable.</p><div class="odoc-spec"><div class="spec value anchored" id="val-get_first_error"><a href="#val-get_first_error" class="anchor"></a><code><span><span class="keyword">val</span> get_first_error : <span><a href="#type-context">context</a> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Context"><a href="#module-Context" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Context/index.html">Context</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="fields"><a href="#fields" class="anchor"></a>Fields</h2><p>A <code>field</code> encapsulates a field within a struct; it is used when creating a struct type (using <a href="Struct/index.html#val-create"><code>Struct.create</code></a>). Fields cannot be shared between structs.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Field"><a href="#module-Field" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Field/index.html">Field</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="structs"><a href="#structs" class="anchor"></a>Structure Types</h2><p>A <code>struct_</code> encapsulates a struct type, either one that we have the layout for, or an opaque type.</p><p>You can model C struct types by creating <code>struct_</code> and <code>field</code> instances, in either order:</p><ul><li><p>by creating the fields, then the structure. For example, to model:</p><pre class="language-ocaml"><code>struct coord {double x; double y; };</code></pre><p>you could call:</p><pre class="language-ocaml"><code>let field_x = Field.create ctx double_type &quot;x&quot; in
let field_y = Field.create ctx double_type &quot;y&quot; in
let coord = Struct.create ctx &quot;coord&quot; [ field_x ; field_y ]</code></pre></li><li><p>by creating the structure, then populating it with fields, typically to allow modelling self-referential structs such as:</p><pre class="language-ocaml"><code>struct node { int m_hash; struct node *m_next; };</code></pre><p>like this:</p><pre class="language-ocaml"><code>let node = Struct.create_opaque ctx &quot;node&quot; in
let node_ptr = Type.pointer node in
let field_hash = Field.create ctx int_type &quot;m_hash&quot; in
let field_next = Field.create ctx node_ptr &quot;m_next&quot; in
Struct.set_fields node [ field_hash; field_next ]</code></pre></li></ul><div class="odoc-spec"><div class="spec module anchored" id="module-Struct"><a href="#module-Struct" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Struct/index.html">Struct</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="types"><a href="#types" class="anchor"></a>Types</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Type"><a href="#module-Type" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Type/index.html">Type</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="rvalues"><a href="#rvalues" class="anchor"></a>Rvalues</h2><p>A <a href="#type-rvalue"><code>rvalue</code></a> is an expression that can be computed.</p><p>It can be simple, e.g.:</p><ul><li>an integer value e.g. <code>0</code> or <code>42</code></li><li>a string literal e.g. <code>&quot;Hello world&quot;</code></li><li>a variable e.g. <code>i</code>. These are also <a href="#lvalues" title="lvalues">lvalues</a> (see below).</li></ul><p>or compound e.g.:</p><ul><li>a unary expression e.g. <code>!cond</code></li><li>a binary expression e.g. <code>(a + b)</code></li><li>a function call e.g. <code>get_distance (&amp;player_ship, &amp;target)</code></li><li>etc.</li></ul><p>Every <a href="#type-rvalue"><code>rvalue</code></a> has an associated <a href="#type-type_" title="type_">type</a>, and the API will check to ensure that types match up correctly (otherwise the context will emit an error).</p><div class="odoc-spec"><div class="spec module anchored" id="module-RValue"><a href="#module-RValue" class="anchor"></a><code><span><span class="keyword">module</span> <a href="RValue/index.html">RValue</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="lvalues"><a href="#lvalues" class="anchor"></a>Lvalues</h2><p>An <a href="#type-lvalue"><code>lvalue</code></a> is something that can of the left-hand side of an assignment: a storage area (such as a variable). It is also usable as an <a href="#type-rvalue"><code>rvalue</code></a>, where the <a href="#type-rvalue"><code>rvalue</code></a> is computed by reading from the storage area.</p><div class="odoc-spec"><div class="spec module anchored" id="module-LValue"><a href="#module-LValue" class="anchor"></a><code><span><span class="keyword">module</span> <a href="LValue/index.html">LValue</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="params"><a href="#params" class="anchor"></a>Parameters</h2><p>A value of type <a href="#type-param"><code>param</code></a> represents a parameter to a <a href="#functions" title="functions">function</a>.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Param"><a href="#module-Param" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Param/index.html">Param</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="functions"><a href="#functions" class="anchor"></a>Functions</h2><p>A values of type <code>function_</code> encapsulates a function: either one that you're creating yourself, or a reference to one that you're dynamically linking to within the rest of the process.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Function"><a href="#module-Function" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Function/index.html">Function</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="blocks"><a href="#blocks" class="anchor"></a>Basic Blocks</h2><p>A <code>block</code> encapsulates a <em>basic block</em> of statements within a function (i.e. with one entry point and one exit point).</p><ul><li>Every block within a function must be terminated with a conditional, a branch, or a return.</li><li>The blocks within a function form a directed graph.</li><li>The entrypoint to the function is the first block created within it.</li><li>All of the blocks in a function must be reachable via some path from the first block.</li><li>It's OK to have more than one <em>return</em> from a function (i.e., multiple blocks that terminate by returning.</li></ul><div class="odoc-spec"><div class="spec module anchored" id="module-Block"><a href="#module-Block" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Block/index.html">Block</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="locations"><a href="#locations" class="anchor"></a>Source Locations</h2><p>A <a href="#type-location"><code>location</code></a> encapsulates a source code location, so that you can (optionally) associate locations in your language with statements in the JIT-compiled code, allowing the debugger to single-step through your language.</p><ul><li><a href="#type-location"><code>location</code></a> instances are optional: you can always omit them to any API entrypoint accepting one.</li><li>You can construct them using <a href="Location/index.html#val-create"><code>Location.create</code></a>.</li><li>You need to <a href="Context/index.html#val-set_option" title="Context.set_option">enable</a> <a href="Context/index.html#type-context_option" title="Context.context_option"><code>Debuginfo</code></a> on the <a href="#type-context"><code>context</code></a> for these locations to actually be usable by the debugger.</li></ul><h3 id="faking-it"><a href="#faking-it" class="anchor"></a>Faking it</h3><p>If you don't have source code for your internal representation, but need to debug, you can generate a C-like representation of the functions in your context using <a href="Context/index.html#val-dump_to_file"><code>Context.dump_to_file</code></a>. This will dump C-like code to the given path. If the update_locations argument is true, this will also set up <a href="#type-location"><code>location</code></a> information throughout the context, pointing at the dump file as if it were a source file, giving you something you can step through in the debugger.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Location"><a href="#module-Location" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Location/index.html">Location</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="inmemory"><a href="#inmemory" class="anchor"></a>In-memory compilation</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Result"><a href="#module-Result" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Result/index.html">Result</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
